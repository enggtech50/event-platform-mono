plugins {
  id 'java'
  id 'application'
  id 'org.springframework.boot'
  id 'io.spring.dependency-management'
  id 'jacoco'
}

repositories {
  gradlePluginPortal()
  mavenCentral()
}

java {
  toolchain {
    languageVersion = JavaLanguageVersion.of(17)
  }
}

ext {
  set('springCloudVersion', '2023.0.1')
}

configurations {
  compileOnly {
    extendsFrom annotationProcessor
  }
  customConfig.extendsFrom testImplementation
}

jacoco {
  toolVersion = "0.8.11"
  reportsDirectory = file("$buildDir/customJacocoReportDir")
}

dependencyManagement {
  imports {
    mavenBom "org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}"
  }
  imports {
    mavenBom "org.springframework.boot:spring-boot-dependencies:3.2.4"
  }
}

dependecies {
  implementation 'com.fasterxml.jackson.core:jackson-databind:2.19.0'
  implementation 'org.springframework.cloud:spring-cloud-starter:4.0.2'
  testImplementation 'org.springframework.boot:spring-boot-starter-test:3.2.4'
}

task copyNativeDeps(type: Copy) {
  from(configurations.customConfig) {
    include '*.dll'
    include '*.dylib'
    include '*.so'
  }
  into 'native-libs'
  doLast {
    println "Native java-libraries generated"
  }
}